# エンティティ設計書

Flequitアプリケーションのデータベーススキーマ定義とエンティティ仕様書です。

## 概要

本ディレクトリには、Flequitで使用される全24テーブルの詳細仕様が個別ファイルとして格納されています。
各ファイルは統一されたフォーマットでフィールド定義、制約、インデックス、関連テーブルの情報を含んでいます。

## 主要スキーマ

### 🏢 accounts - アカウント管理

アカウント内部識別子と認証プロバイダー情報を管理する基盤スキーマ。
ユーザーIDとは分離された内部管理用エンティティで、認証システムの中核を担います。
LocalSQLite、LocalAutomergeでは完全に秘匿するべき内容で、どことも同期せずにそのPC内で完結すべきです。
また、暗号化要件を必須とします。
OSの認証システムを利用した場合のみ暗号化が解除されます。

**ファイル名**
LocalSQLite: ./accounts.database
LocalAutomerge: ./accounts.automerge

### 👥 users - ユーザー情報

公開ユーザー情報を管理するスキーマ。
他者から参照可能な公開識別子を持ち、プロジェクトメンバーシップやタスク担当者として使用されます。
他人から参照されることをOKとします。

**ファイル名**
LocalSQLite: ./users.database
LocalAutomerge: ./users.automerge

### 📁 projects - プロジェクト管理

プロジェクト管理の基本エンティティ。
タスクやメンバーの親コンテナとして機能し、全てのタスク管理活動の基本単位となります。
プロジェクト遂行に必要な情報は全てこの中に集約します。

**ファイル名**
LocalSQLite: ./projects/{project_id}.database
LocalAutomerge: ./projects/{project_id}.automerge
※プロジェクトごとに1ファイル

### ⚙️ settings - 汎用設定

ユーザー設定に関するスキーマ。

**ファイル名**
LocalSQLite: ./settings.database
LocalAutomerge: ./settings.automerge

## ファイル構造

各エンティティファイルは以下の統一フォーマットで記述されています：

```markdown
# エンティティ名 (日本語名) - テーブル名

## 概要
エンティティの役割と用途の説明

## フィールド定義
フィールド定義テーブル（論理名、物理名、型、制約等）

## 制約
主キー、外部キー、制約情報

## インデックス
パフォーマンス最適化用インデックス定義

## 関連テーブル
他テーブルとの関係性

## 備考
設計上の注意点や特記事項
```

## 型システム

全エンティティは統一された型システムを使用します：

- **ID型**: 専用型（ProjectId, AccountId, UserId等）
- **日時型**: `DateTime<Utc>` (ISO 8601形式)
- **Optional型**: `Option<T>` (NULL許可)
- **文字列型**: `String`
- **数値型**: `i32`, `bool`

詳細な型変換規則については `../data-model.md` の型変換表を参照してください。

## 使用方法

1. **新規エンティティ追加**: `__entity_example.md` テンプレートを参考に作成
2. **既存エンティティ修正**: 該当ファイルを直接編集
3. **関係性確認**: 各ファイルの「関連テーブル」セクションを参照
4. **インデックス設計**: 各ファイルの「インデックス」セクションのSQL文を使用

## 参考資料

- `__entity_example.md`: エンティティファイル作成テンプレート
- `../data-model.md`: 型変換表とシステム全体仕様
- `../data-structure.md`: Automerge CRDT設計仕様
